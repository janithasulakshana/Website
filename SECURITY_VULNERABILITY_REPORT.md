# Security Vulnerability Assessment Report
**Trail Colombo Website**  
**Date:** February 22, 2026

---

## Executive Summary

‚ö†Ô∏è **CRITICAL ISSUES FOUND: 5**  
‚ö†Ô∏è **HIGH SEVERITY ISSUES: 3**  
‚ö†Ô∏è **MEDIUM SEVERITY ISSUES: 4**  
‚úÖ **LOW SEVERITY ISSUES: 2**

---

## üî¥ CRITICAL VULNERABILITIES

### 1. **Hardcoded JWT Secret Key**
**Severity:** üî¥ CRITICAL  
**Location:** `backend/server.js` (Lines 44, 155)

**Issue:**
```javascript
const decoded = jwt.verify(token, "your-secret-key");  // ‚Üê HARDCODED!
const token = jwt.sign({...}, "your-secret-key", {expiresIn: "24h"});  // ‚Üê HARDCODED!
```

**Risk:** Anyone with access to the source code can forge JWT tokens and bypass authentication.

**Fix:**
```javascript
// Use environment variable
const JWT_SECRET = process.env.JWT_SECRET || "your_secure_random_key_here";
const decoded = jwt.verify(token, JWT_SECRET);
const token = jwt.sign({...}, JWT_SECRET, {expiresIn: "24h"});
```

**Action:** üîß Use `.env` file:
```
JWT_SECRET=your_very_secure_random_key_min_32_chars_long_12345678901234567890
```

---

### 2. **Storing Passwords with Weak Hash Configuration**
**Severity:** üî¥ CRITICAL  
**Location:** `backend/server.js` (Line 140)

**Issue:**
```javascript
const hashedPassword = bcrypt.hashSync(password, 10);  // Only 10 salt rounds
```

**Risk:** 10 salt rounds is minimum. For security-critical applications, use 12+.

**Fix:**
```javascript
const hashedPassword = bcrypt.hashSync(password, 12);  // Better security
```

---

### 3. **Exposed Database File**
**Severity:** üî¥ CRITICAL  
**Location:** `backend/server.js` (Line 13)

**Issue:**
```javascript
const db = new sqlite3.Database("./bookings.db");  // ‚Üê Relative path
```

**Risk:** 
- Database accessible from web root
- No backup/recovery protection
- Can be accidentally committed to git

**Fix:**
```javascript
const dbPath = process.env.DATABASE_PATH || path.join(__dirname, '../data/bookings.db');
const db = new sqlite3.Database(dbPath);
```

Add to `.env`:
```
DATABASE_PATH=/secure/path/outside/web/root/bookings.db
```

---

### 4. **Missing Input Validation & Sanitization**
**Severity:** üî¥ CRITICAL  
**Location:** `backend/server.js` (Bookings and Tours endpoints)

**Issue:**
```javascript
// No email format validation
// No phone number validation
// No HTML/Script injection prevention
const { name, email, phone, tour_id, date } = req.body;
db.run(`INSERT INTO bookings ...`, [name, email, phone, tour_id, date], ...)
```

**Risk:**
- XSS attacks through name/description fields
- Invalid data in database
- Email injection attacks

**Fix:**
```javascript
const validator = require('validator');

// Email validation
if (!validator.isEmail(email)) {
  return res.status(400).json({ error: "Invalid email format" });
}

// Name sanitization
const sanitizedName = validator.escape(name).trim();
if (sanitizedName.length < 2 || sanitizedName.length > 100) {
  return res.status(400).json({ error: "Invalid name length" });
}

// Phone validation
if (!validator.isMobilePhone(phone)) {
  return res.status(400).json({ error: "Invalid phone format" });
}
```

---

## üü† HIGH SEVERITY ISSUES

### 5. **Missing CORS Validation**
**Severity:** üü† HIGH  
**Location:** `backend/server.js` (Line 11)

**Issue:**
```javascript
app.use(cors());  // ‚Üê Accepts requests from ANY origin!
```

**Risk:** Allows any website to make requests to your API (CSRF attacks, API abuse)

**Fix:**
```javascript
const corsOptions = {
  origin: process.env.ALLOWED_ORIGINS?.split(',') || ['http://localhost:5173'],
  credentials: true,
  optionsSuccessStatus: 200,
  methods: ['GET', 'POST', 'PUT', 'DELETE'],
  allowedHeaders: ['Content-Type', 'Authorization']
};
app.use(cors(corsOptions));
```

---

### 6. **Sensitive Error Messages Exposed**
**Severity:** üü† HIGH  
**Location:** `backend/server.js` (Multiple endpoints)

**Issue:**
```javascript
if (err) return res.status(500).json({ error: err.message });  // ‚Üê Exposes database errors!
```

**Risk:** Reveals database structure, field names, SQL syntax to attackers

**Fix:**
```javascript
if (err) {
  console.error('Database error:', err);  // Log for debugging
  return res.status(500).json({ error: "An error occurred. Please try again." });
}
```

---

### 7. **JWT Token Stored in localStorage**
**Severity:** üü† HIGH  
**Location:** `frontend/src/pages/Admin.jsx` (Line 38)

**Issue:**
```jsx
localStorage.setItem("adminToken", res.data.token);  // ‚Üê XSS vulnerable!
const token = localStorage.getItem("adminToken");
```

**Risk:** 
- Vulnerable to XSS attacks (JavaScript can steal tokens)
- Tokens persist even after browser close
- No httpOnly flag

**Fix (Partial - best practice requires backend changes):**
```jsx
// Use sessionStorage for current session only
sessionStorage.setItem("adminToken", res.data.token);

// Or better - use httpOnly cookies (requires backend support)
// The backend should set: Set-Cookie: adminToken=...; HttpOnly; Secure; SameSite=Strict
```

---

## üü° MEDIUM SEVERITY ISSUES

### 8. **No Rate Limiting on API Endpoints**
**Severity:** üü° MEDIUM  
**Location:** `backend/server.js` (All endpoints)

**Issue:** Anyone can spam login attempts or booking requests

**Fix:**
```bash
npm install express-rate-limit
```

```javascript
const rateLimit = require('express-rate-limit');

// Login rate limiter
const loginLimiter = rateLimit({
  windowMs: 15 * 60 * 1000, // 15 minutes
  max: 5, // 5 attempts
  message: "Too many login attempts. Try again later."
});

// Booking rate limiter
const bookingLimiter = rateLimit({
  windowMs: 60 * 1000, // 1 minute
  max: 3  // 3 bookings per minute
});

app.post("/api/admin/login", loginLimiter, (req, res) => {...});
app.post("/api/bookings", bookingLimiter, (req, res) => {...});
```

---

### 9. **Missing HTTPS/TLS Configuration**
**Severity:** üü° MEDIUM  
**Location:** Backend server startup

**Issue:**
```javascript
app.listen(5000, "127.0.0.1", () => console.log("..."));
// No HTTPS, no security headers
```

**Risk:** Data transmitted in plain text (credentials, personal info)

**Fix:**
```javascript
const https = require('https');
const fs = require('fs');

const options = {
  key: fs.readFileSync('path/to/private-key.pem'),
  cert: fs.readFileSync('path/to/certificate.pem')
};

https.createServer(options, app).listen(5000, () => {
  console.log("Secure server running...");
});

// Add security headers
const helmet = require('helmet');
app.use(helmet());
```

---

### 10. **No SQL Injection Prevention (Partial)**
**Severity:** üü° MEDIUM  
**Location:** `backend/server.js` (All database queries)

**Status:** ‚úÖ Partially Protected
- ‚úÖ Using parameterized queries (?)
- ‚ùå Not validating parameter types

**Improvement:**
```javascript
// Validate tour_id is a number before using in query
const tourId = parseInt(req.params.id);
if (isNaN(tourId)) {
  return res.status(400).json({ error: "Invalid tour ID" });
}
db.run("DELETE FROM tours WHERE id = ?", [tourId], ...)
```

---

### 11. **No Authentication for Public Endpoints**
**Severity:** üü° MEDIUM  
**Location:** `backend/server.js`

**Issue:**
```javascript
app.post("/api/bookings", (req, res) => {  // ‚Üê No authentication
  // Anyone can create bookings!
```

**Risk:** 
- Spam bookings
- Resource exhaustion
- Fake booking data

**Consideration:** This might be intentional (customers booking), but needs rate limiting (see issue #8)

---

## üü¢ LOW SEVERITY ISSUES

### 12. **Missing Security Headers**
**Severity:** üü¢ LOW  
**Location:** `backend/server.js`

**Add:**
```javascript
const helmet = require('helmet');
app.use(helmet());

// Custom headers
app.use((req, res, next) => {
  res.setHeader('X-Content-Type-Options', 'nosniff');
  res.setHeader('X-Frame-Options', 'DENY');
  res.setHeader('X-XSS-Protection', '1; mode=block');
  next();
});
```

---

### 13. **No Logging/Audit Trail**
**Severity:** üü¢ LOW  
**Location:** Throughout backend

**Add logging for security events:**
```javascript
const winston = require('winston');

const logger = winston.createLogger({
  level: 'info',
  format: winston.format.json(),
  filename: 'logs/security.log'
});

// Log all admin actions
logger.info(`Admin login attempt: ${email}`);
logger.info(`Tour deleted: ${tourId} by admin ${adminId}`);
logger.info(`Booking created: ${bookingId}`);
```

---

## Priority Fix Checklist

### üî¥ CRITICAL (Fix Immediately)
- [ ] Move JWT secret to `.env`
- [ ] Increase bcrypt salt rounds to 12
- [ ] Move database outside web root
- [ ] Add input validation and sanitization
- [ ] Fix CORS to allow only specific origins

### üü† HIGH (Fix Before Production)
- [ ] Replace error messages
- [ ] Move JWT from localStorage to secure cookies
- [ ] Add security headers

### üü° MEDIUM (Fix Soon)
- [ ] Add rate limiting
- [ ] Enable HTTPS/TLS
- [ ] Validate parameter types
- [ ] Consider booking authentication

### üü¢ LOW (Nice to Have)
- [ ] Add comprehensive logging
- [ ] Add more security headers

---

## Recommendations by Environment

### Development Environment
‚úÖ Current setup acceptable with security warnings logged

### Production Environment
‚ùå **NOT READY FOR PRODUCTION**

Required before deploying:
1. All CRITICAL issues fixed
2. HTTPS/TLS enabled
3. Environment variables configured
4. Rate limiting implemented
5. Security headers added
6. Database backup/recovery plan
7. Monitoring and logging enabled
8. Secrets management (not in code)

---

## Implementation Priority

**Week 1 - CRITICAL FIXES:**
```bash
# 1. Install security packages
npm install validator helmet express-rate-limit

# 2. Update backend/server.js with all critical fixes
# 3. Update .env file
# 4. Test all endpoints
```

**Week 2 - HIGH PRIORITY:**
```bash
# 1. Implement security headers
# 2. Fix JWT token storage (frontend)
# 3. Add comprehensive logging
# 4. Set up HTTPS/TLS
```

**Week 3 - PRODUCTION READY:**
```bash
# 1. Security audit
# 2. Penetration testing
# 3. Deploy to staging
# 4. Final review
# 5. Production deployment
```

---

## Compliance & Standards

This project should meet:
- ‚úÖ OWASP Top 10 requirements
- ‚úÖ GDPR (if EU users) - add privacy policy
- ‚úÖ PCI DSS (if payment processing added)
- ‚úÖ Basic data protection standards

---

## Contact & Support

For security concerns or vulnerability reports:
- **Security Email:** security@trailcolombo.com
- **Report Method:** Encrypted email preferred
- **Response Time:** 48 hours
